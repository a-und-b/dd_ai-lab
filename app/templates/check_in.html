{% extends "base.html" %}

{% block title %}Check-In{% endblock %}

{% block content %}
<h2>Check-In</h2>
<form action="/jobs" method="post">
    Nickname: <input type="text" name="nickname" required><br>
    Charakter: <input type="text" name="character" required><br>
    Fandom: <input type="text" name="fandom" required><br>
    Hintergrund: <textarea name="background" required></textarea><br>
    Stimmung: <select name="mood">
        <option value="heroisch">Heroisch</option>
        <option value="verträumt">Verträumt</option>
        <option value="mysteriös">Mysteriös</option>
        <option value="fröhlich">Fröhlich</option>
    </select><br>
    Stil: <select name="style">
        <option value="realistisch">Realistisch</option>
        <option value="anime">Anime/Manga</option>
        <option value="3d-render">3D-Render</option>
        <option value="comic">Comic</option>
    </select><br>
    <button type="submit">Check In</button>
</form>

<h2>Current Jobs</h2>
<ul id="jobList"></ul>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const updateStatus = (jobId, newStatus) => {
        fetch(`/jobs/${jobId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ status: newStatus })
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            window.location.reload(); // Reload to see the updated status
        })
        .catch(error => console.error('Error updating job status:', error));
    };

    fetch('/jobs')
    .then(response => response.json())
    .then(data => {
        const list = document.getElementById('jobList');
        data.forEach(job => {
            const item = document.createElement('li');
            item.textContent = `${job.nickname} - ${job.status} `;
            const statuses = ['new', 'shooting', 'assets-ready', 'processing', 'output-ready', 'finished'];
            statuses.forEach(status => {
                const statusBtn = document.createElement('button');
                statusBtn.textContent = status;
                statusBtn.onclick = () => updateStatus(job.id, status);
                item.appendChild(statusBtn);
            });
            list.appendChild(item);
        });
    });
});
</script>
{% endblock %}
