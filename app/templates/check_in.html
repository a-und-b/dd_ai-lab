{% extends "base.html" %}

{% block title %}Check-In{% endblock %}

{% block content %}
<h2>Check-In</h2>
<form action="/jobs" method="post">
    Nickname: <input type="text" name="nickname" required><br>
    <button type="submit">Check In</button>
</form>

<h2>Current Jobs</h2>
<ul id="jobList"></ul>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const updateStatus = (jobId, newStatus) => {
        fetch(`/jobs/${jobId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ status: newStatus })
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            window.location.reload(); // Reload to see the updated status
        })
        .catch(error => console.error('Error updating job status:', error));
    };

    fetch('/jobs')
    .then(response => response.json())
    .then(data => {
        const list = document.getElementById('jobList');
        data.forEach(job => {
            const item = document.createElement('li');
            item.textContent = `${job.nickname} - ${job.status} `;
            const statuses = ['new', 'shooting', 'assets-ready', 'processing', 'output-ready', 'finished'];
            statuses.forEach(status => {
                const statusBtn = document.createElement('button');
                statusBtn.textContent = status;
                statusBtn.onclick = () => updateStatus(job.id, status);
                item.appendChild(statusBtn);
            });
            list.appendChild(item);
        });
    });
});
</script>
{% endblock %}